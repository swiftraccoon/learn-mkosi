# SPDX-License-Identifier: MIT
# Level 1: Minimal Security Configuration
# Target: Development, learning, base customization
# Security: Baseline protections

[Config]
MinimumVersion=25

[Distribution]
Distribution=fedora
Release=42

[Output]
Format=disk
OutputDirectory=mkosi.output
ImageId=fedora-minimal-level1
ImageVersion=1.0
CompressOutput=zstd

[Content]
# Minimal package set for functional system
Packages=
    # Kernel & Core System
    kernel
    systemd
    systemd-udev
    dbus
    dbus-broker

    # Base Utilities
    coreutils
    util-linux
    bash
    grep
    sed
    gawk
    findutils
    which
    procps-ng
    psmisc
    shadow-utils
    sudo
    less
    tar
    gzip
    bzip2
    xz

    # Filesystem
    filesystem
    e2fsprogs
    dosfstools

    # Networking
    NetworkManager
    iproute
    iputils
    hostname

    # Security Baseline
    selinux-policy-targeted
    policycoreutils
    firewalld
    cracklib-dicts
    cryptsetup

    # CPU Microcode Updates (security-critical firmware)
    microcode_ctl

    # Kernel Modules (for network filesystems & crypto)
    kernel-modules-extra

    # Package Management
    dnf
    rpm

    # Text Editor
    vim-minimal

    # Time & SSL
    tzdata
    ca-certificates
    chrony

    # Bootloader
    systemd-boot-unsigned

# Build-time only packages
BuildPackages=
    systemd-rpm-macros

# Minimize image size
WithDocs=no
WithRecommends=no
CleanPackageMetadata=auto

# SELinux configuration
SELinuxRelabel=yes

# Bootloader configuration
Bootable=yes
Bootloader=systemd-boot
UnifiedKernelImages=unsigned

# Kernel command line embedded in UKI
KernelCommandLine=rw console=hvc0

# Post-installation script
PostInstallationScripts=mkosi.postinst

[Runtime]
# Runtime configuration for testing with QEMU
Firmware=uefi
RAM=2G
CPUs=2
# Use hvc0 for virtio console (not ttyS0 for legacy serial)
KernelCommandLineExtra=console=hvc0
